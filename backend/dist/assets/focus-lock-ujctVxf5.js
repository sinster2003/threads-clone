var P="data-focus-lock",$="data-focus-lock-disabled",rr="data-no-focus-lock",nr="data-autofocus-inside",er="data-no-autofocus",d=function(r){for(var n=Array(r.length),e=0;e<r.length;++e)n[e]=r[e];return n},g=function(r){return Array.isArray(r)?r:[r]},B=function(r){return Array.isArray(r)?r[0]:r},tr=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var n=window.getComputedStyle(r,null);return!n||!n.getPropertyValue?!1:n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"},L=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},R=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},ar=function(r,n){return!r||R(r)||!tr(r)&&n(L(r))},H=function(r,n){var e=r.get(n);if(e!==void 0)return e;var t=ar(n,H.bind(void 0,r));return r.set(n,t),t},ur=function(r,n){return r&&!R(r)?fr(r)?n(L(r)):!1:!0},q=function(r,n){var e=r.get(n);if(e!==void 0)return e;var t=ur(n,q.bind(void 0,r));return r.set(n,t),t},G=function(r){return r.dataset},or=function(r){return r.tagName==="BUTTON"},V=function(r){return r.tagName==="INPUT"},j=function(r){return V(r)&&r.type==="radio"},ir=function(r){return!((V(r)||or(r))&&(r.type==="hidden"||r.disabled))},fr=function(r){var n=r.getAttribute(er);return![!0,"true",""].includes(n)},T=function(r){var n;return!!(r&&(!((n=G(r))===null||n===void 0)&&n.focusGuard))},I=function(r){return!T(r)},cr=function(r){return!!r},dr=function(r,n){var e=r.tabIndex-n.tabIndex,t=r.index-n.index;if(e){if(!r.tabIndex)return 1;if(!n.tabIndex)return-1}return e||t},K=function(r,n,e){return d(r).map(function(t,a){return{node:t,index:a,tabIndex:e&&t.tabIndex===-1?(t.dataset||{}).focusGuard?0:-1:t.tabIndex}}).filter(function(t){return!n||t.tabIndex>=0}).sort(dr)},vr=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],S=vr.join(","),sr="".concat(S,", [data-focus-guard]"),Y=function(r,n){return d((r.shadowRoot||r).children).reduce(function(e,t){return e.concat(t.matches(n?sr:S)?[t]:[],Y(t))},[])},lr=function(r,n){var e;return r instanceof HTMLIFrameElement&&(!((e=r.contentDocument)===null||e===void 0)&&e.body)?F([r.contentDocument.body],n):[r]},F=function(r,n){return r.reduce(function(e,t){var a,i=Y(t,n),u=(a=[]).concat.apply(a,i.map(function(o){return lr(o,n)}));return e.concat(u,t.parentNode?d(t.parentNode.querySelectorAll(S)).filter(function(o){return o===t}):[])},[])},br=function(r){var n=r.querySelectorAll("[".concat(nr,"]"));return d(n).map(function(e){return F([e])}).reduce(function(e,t){return e.concat(t)},[])},w=function(r,n){return d(r).filter(function(e){return H(n,e)}).filter(function(e){return ir(e)})},U=function(r,n){return n===void 0&&(n=new Map),d(r).filter(function(e){return q(n,e)})},A=function(r,n,e){return K(w(F(r,e),n),!0,e)},D=function(r,n){return K(w(F(r),n),!1)},mr=function(r,n){return w(br(r),n)},m=function(r,n){return r.shadowRoot?m(r.shadowRoot,n):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,n)?!0:d(r.children).some(function(e){var t;if(e instanceof HTMLIFrameElement){var a=(t=e.contentDocument)===null||t===void 0?void 0:t.body;return a?m(a,n):!1}return m(e,n)})},Or=function(r){for(var n=new Set,e=r.length,t=0;t<e;t+=1)for(var a=t+1;a<e;a+=1){var i=r[t].compareDocumentPosition(r[a]);(i&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&n.add(a),(i&Node.DOCUMENT_POSITION_CONTAINS)>0&&n.add(t)}return r.filter(function(u,o){return!n.has(o)})},z=function(r){return r.parentNode?z(r.parentNode):r},E=function(r){var n=g(r);return n.filter(Boolean).reduce(function(e,t){var a=t.getAttribute(P);return e.push.apply(e,a?Or(d(z(t).querySelectorAll("[".concat(P,'="').concat(a,'"]:not([').concat($,'="disabled"])')))):[t]),e},[])},hr=function(r){try{return r()}catch{return}},h=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var n=r.activeElement;return n.shadowRoot?h(n.shadowRoot):n instanceof HTMLIFrameElement&&hr(function(){return n.contentWindow.document})?h(n.contentWindow.document):n}},gr=function(r,n){return r===n},Ir=function(r,n){return!!d(r.querySelectorAll("iframe")).some(function(e){return gr(e,n)})},Er=function(r,n){return n===void 0&&(n=h(B(r).ownerDocument)),!n||n.dataset&&n.dataset.focusGuard?!1:E(r).some(function(e){return m(e,n)||Ir(e,n)})},_r=function(r){r===void 0&&(r=document);var n=h(r);return n?d(r.querySelectorAll("[".concat(rr,"]"))).some(function(e){return m(e,n)}):!1},Fr=function(r,n){return n.filter(j).filter(function(e){return e.name===r.name}).filter(function(e){return e.checked})[0]||r},_=function(r,n){return j(r)&&r.name?Fr(r,n):r},pr=function(r){var n=new Set;return r.forEach(function(e){return n.add(_(e,r))}),r.filter(function(e){return n.has(e)})},k=function(r){return r[0]&&r.length>1?_(r[0],r):r[0]},W=function(r,n){return r.length>1?r.indexOf(_(r[n],r)):n},J="NEW_FOCUS",xr=function(r,n,e,t){var a=r.length,i=r[0],u=r[a-1],o=T(e);if(!(e&&r.indexOf(e)>=0)){var f=e!==void 0?n.indexOf(e):-1,v=t?n.indexOf(t):f,s=t?r.indexOf(t):-1,c=f-v,O=n.indexOf(i),l=n.indexOf(u),b=pr(n),X=e!==void 0?b.indexOf(e):-1,Z=X-(t?b.indexOf(t):f),C=W(r,0),M=W(r,a-1);if(f===-1||s===-1)return J;if(!c&&s>=0)return s;if(f<=O&&o&&Math.abs(c)>1)return M;if(f>=l&&o&&Math.abs(c)>1)return C;if(c&&Math.abs(Z)>1)return s;if(f<=O)return M;if(f>l)return C;if(c)return Math.abs(c)>1?s:(a+s+c)%a}},yr=function(r){return function(n){var e,t=(e=G(n))===null||e===void 0?void 0:e.autofocus;return n.autofocus||t!==void 0&&t!=="false"||r.indexOf(n)>=0}},Ar=function(r,n,e){var t=r.map(function(i){var u=i.node;return u}),a=U(t.filter(yr(e)));return a&&a.length?k(a):k(U(n))},N=function(r,n){return n===void 0&&(n=[]),n.push(r),r.parentNode&&N(r.parentNode.host||r.parentNode,n),n},p=function(r,n){for(var e=N(r),t=N(n),a=0;a<e.length;a+=1){var i=e[a];if(t.indexOf(i)>=0)return i}return!1},Q=function(r,n,e){var t=g(r),a=g(n),i=t[0],u=!1;return a.filter(Boolean).forEach(function(o){u=p(u||o,o)||u,e.filter(Boolean).forEach(function(f){var v=p(i,f);v&&(!u||m(v,u)?u=v:u=p(v,u))})}),u},Nr=function(r,n){return r.reduce(function(e,t){return e.concat(mr(t,n))},[])},Tr=function(r,n){var e=new Map;return n.forEach(function(t){return e.set(t.node,t)}),r.map(function(t){return e.get(t)}).filter(cr)},Sr=function(r,n){var e=h(g(r).length>0?document:B(r).ownerDocument),t=E(r).filter(I),a=Q(e||r,r,t),i=new Map,u=D(t,i),o=A(t,i).filter(function(l){var b=l.node;return I(b)});if(!(!o[0]&&(o=u,!o[0]))){var f=D([a],i).map(function(l){var b=l.node;return b}),v=Tr(f,o),s=v.map(function(l){var b=l.node;return b}),c=xr(s,f,e,n);if(c===J){var O=Ar(u,s,Nr(t,i));if(O)return{node:O};console.warn("focus-lock: cannot find any node to move focus into");return}return c===void 0?c:v[c]}},Cr=function(r){var n=E(r).filter(I),e=Q(r,r,n),t=new Map,a=A([e],t,!0),i=A(n,t).filter(function(u){var o=u.node;return I(o)}).map(function(u){var o=u.node;return o});return a.map(function(u){var o=u.node,f=u.index;return{node:o,index:f,lockItem:i.indexOf(o)>=0,guard:T(o)}})},wr=function(r,n){"focus"in r&&r.focus(n),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus()},x=0,y=!1,Mr=function(r,n,e){e===void 0&&(e={});var t=Sr(r,n);if(!y&&t){if(x>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),y=!0,setTimeout(function(){y=!1},1);return}x++,wr(t.node,e.focusOptions),x--}};export{$ as F,P as a,_r as b,Cr as e,Er as f,Mr as m};
